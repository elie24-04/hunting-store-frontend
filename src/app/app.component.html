<div class="page-wrapper" [class.auth-mode]="isAuthView">

  <div *ngIf="!isAuthView">
    <!-- Offcanvas (mobile/tablet) -->
    <div
      class="offcanvas offcanvas-start d-lg-none"
      tabindex="-1"
      id="categoriesOffcanvas"
      aria-labelledby="categoriesOffcanvasLabel"
    >
      <div class="offcanvas-header">
        <h5 class="offcanvas-title" id="categoriesOffcanvasLabel">Categories</h5>
        <button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Close"></button>
      </div>
      <div class="offcanvas-body p-0">
        <app-product-category-menu></app-product-category-menu>
      </div>
    </div>
  </div>

  <div class="page-container" [class.full-width]="isAuthView">

    <ng-container *ngIf="!isAuthView">
      <div class="page-wrap">
        <div class="site-announcement">
      <p>
        Purchase now and get free delivery on every order ’'?” limited-time offer!
      </p>
      <a class="announcement-btn" routerLink="/products">
        Shop &amp; save now
      </a>
    </div>

    <header class="header-desktop topbar">
      <div class="section-content section-content-p30">
        <div class="container-fluid">
          <div class="topbar-inner d-flex flex-column flex-lg-row align-items-stretch align-items-lg-center gap-2 gap-lg-3 py-2">

            <div class="search-block flex-grow-1">
              <div class="d-flex gap-2 align-items-center">
                <button
                  class="btn btn-outline-light d-lg-none categories-toggle"
                  type="button"
                  data-bs-toggle="offcanvas"
                  data-bs-target="#categoriesOffcanvas"
                  aria-controls="categoriesOffcanvas"
                >
                  <i class="bi bi-list"></i>
                  Categories
                </button>
                <input
                  class="form-control search-input flex-grow-1"
                  type="text"
                  placeholder="Search for products..."
                  aria-label="Search for products"
                  [(ngModel)]="term"
                  (keyup.enter)="onSearch()"
                />
                <button class="btn search-btn" type="button" (click)="onSearch()">
                  Search
                </button>
              </div>
            </div>

            <div class="actions-block d-flex align-items-center justify-content-between justify-content-lg-end gap-2 flex-wrap">
              <a class="cart-pill" routerLink="/cart-details">
                <span class="cart-total">${{ (cartTotal || 0) | number:'1.2-2' }}</span>
                <span class="cart-qty">{{ cartQty }}</span>
                <i class="bi bi-cart3"></i>
              </a>
              <a class="message-link" routerLink="/message" routerLinkActive="active">
                <i class="bi bi-envelope"></i>
                <span>Messages</span>
              </a>

              <ng-container *ngIf="!isLoggedIn; else loggedInBlock">
                <a class="auth-link" routerLink="/login">Log in</a>
                <a class="btn auth-btn" routerLink="/register">Create account</a>
              </ng-container>

              <ng-template #loggedInBlock>
                <span class="signed-as d-none d-md-inline">Signed in as {{ userName }}</span>
                <button class="btn auth-btn logout-btn" (click)="logout()">Log out</button>
              </ng-template>
            </div>

          </div>
        </div>
      </div>
    </header>
      </div>
    </ng-container>

    <ng-container *ngIf="!isAuthView; else authView">
    <main class="main-content">
      <div class="page-fluid">
        <div class="page-inner">
          <div class="row g-3">
            <div class="col-lg-3 d-none d-lg-block">
              <aside class="sidebar-sticky">
                <app-product-category-menu></app-product-category-menu>
              </aside>
            </div>
            <div class="col-12 col-lg-9">
              <router-outlet></router-outlet>
            </div>
          </div>
        </div>
      </div>
    </main>
    </ng-container>

    <ng-template #authView>
      <router-outlet></router-outlet>
    </ng-template>

  </div>
</div>

<!-- ENDS PAGE CONTAINER -->

<nav class="mobile-bottom-nav d-lg-none" aria-label="Mobile navigation">
  <a routerLink="/" routerLinkActive="active" [routerLinkActiveOptions]="{ exact: true }">
    <i class="bi bi-house"></i>
    <span>Home</span>
  </a>

  <a routerLink="/message" routerLinkActive="active">
    <i class="bi bi-envelope"></i>
    <span>Messages</span>
  </a>

  <button
    type="button"
    class="nav-btn"
    data-bs-toggle="offcanvas"
    data-bs-target="#categoriesOffcanvas"
    aria-label="Open categories"
  >
    <i class="bi bi-grid"></i>
    <span>Categories</span>
  </button>

  <a routerLink="/cart-details" routerLinkActive="active" class="cart-nav">
    <i class="bi bi-cart3"></i>
    <span>Cart</span>
    <span class="cart-badge" *ngIf="cartQty > 0">{{ cartQty }}</span>
  </a>

  <a routerLink="/login" routerLinkActive="active">
    <i class="bi bi-person"></i>
    <span>Account</span>
  </a>
</nav>

<footer *ngIf="!isAuthView" class="site-footer">
  <div class="footer-container">
    <div class="footer-inner">
      <div class="brand-block">
        <div class="crest-icon">Hunting</div>
        <h3>Backcountry Outfitters</h3>
        <p class="brand-tagline">Outfitters for bold backcountry pursuits.</p>
        <p>Premium hunting gear, apparel, and guides for every pursuit.</p>
        <div class="social-links" aria-label="Social links">
          <a
            href="https://www.instagram.com/backcountryoutfitters"
            class="social-icon"
            aria-label="Instagram"
            target="_blank"
            rel="noopener noreferrer"
          >
            <i class="fa-brands fa-instagram"></i>
          </a>
          <a
            href="https://www.youtube.com/@backcountryoutfitters"
            class="social-icon"
            aria-label="YouTube"
            target="_blank"
            rel="noopener noreferrer"
          >
            <i class="fa-brands fa-youtube"></i>
          </a>
          <a
            href="https://www.facebook.com/backcountryoutfitters"
            class="social-icon"
            aria-label="Facebook"
            target="_blank"
            rel="noopener noreferrer"
          >
            <i class="fa-brands fa-facebook-f"></i>
          </a>
        </div>
      </div>
      <div class="link-block">
        <h4>Explore</h4>
        <a routerLink="/">Home</a>
        <a routerLink="/products">Shop All</a>
        <a routerLink="/products/category/new-arrivals">New Arrivals</a>
        <a routerLink="/cart-details">Cart</a>
        <a routerLink="/checkout">Checkout</a>
      </div>
      <div class="link-block">
        <h4>Support</h4>
        <button
          type="button"
          class="footer-link-btn"
          (click)="openSupportModal(sizingGuideModal)"
        >
          Sizing Guide
        </button>
        <button
          type="button"
          class="footer-link-btn"
          (click)="openSupportModal(shippingReturnsModal)"
        >
          Shipping &amp; Returns
        </button>
        <button
          type="button"
          class="footer-link-btn"
          (click)="openSupportModal(fieldCareModal)"
        >
          Field Care Tips
        </button>
        <button
          type="button"
          class="footer-link-btn"
          (click)="openSupportModal(faqModal)"
        >
          FAQ
        </button>
      </div>
      <div class="newsletter-block">
        <h4>Stay updated</h4>
        <p>Get drop alerts, pro tips, and exclusive offers.</p>
        <form class="newsletter-form">
          <input type="email" placeholder="Email address" aria-label="Email" />
          <button type="submit">Join the list</button>
        </form>
        <span class="newsletter-helper">No spam. Unsubscribe anytime.</span>
      </div>
    </div>
    <div class="footer-meta">
      <span>&copy; 2026 Backcountry Outfitters. All rights reserved.</span>
      <div class="meta-links">
        <a href="#">Privacy</a>
        <a href="#">Terms</a>
        <a href="#">Accessibility</a>
      </div>
    </div>
  </div>
</footer>

<ng-template #sizingGuideModal let-modal>
  <div class="modal-header border-0 pb-2">
    <h5 class="modal-title">Sizing Guide</h5>
    <button type="button" class="btn-close btn-close-white" aria-label="Close" (click)="modal.dismiss('closed')"></button>
  </div>
  <div class="modal-body">
    <p class="mb-3">
      Gear that fits keeps you comfortable from the trailhead through the bitter ridge.
      Start with these three easy checkpoints before committing to a bundle.
    </p>
    <ul class="sizing-checklist">
      <li><strong>Chest &amp; waist:</strong> Measure across the widest points while wearing a light base layer.</li>
      <li><strong>Arm &amp; leg length:</strong> Match drops to your height, then verify sleeve/leg ease for layering.</li>
      <li><strong>Footwear:</strong> Leave a thumb-width room in boots, and always try with the sock combination you hike in.</li>
    </ul>
    <p class="modal-footnote">
      Need something custom? Reach out to our support team for a virtual fitting session.
    </p>
  </div>
  <div class="modal-footer border-0 pt-0">
    <button type="button" class="btn btn-secondary" (click)="modal.close('close')">Close</button>
  </div>
</ng-template>

<ng-template #shippingReturnsModal let-modal>
  <div class="modal-header border-0 pb-2">
    <h5 class="modal-title">Shipping &amp; Returns</h5>
    <button type="button" class="btn-close btn-close-white" aria-label="Close" (click)="modal.dismiss('closed')"></button>
  </div>
  <div class="modal-body">
    <p class="mb-3">
      We ship every order with care so your expedition kit arrives ready for the trail.
      Most domestic orders leave our warehouse within 24 hours and arrive in 3-5 business days.
    </p>
    <ul class="sizing-checklist">
      <li><strong>Tracking:</strong> You’ll receive updates at each stage of transit, including delivery confirmation.</li>
      <li><strong>Returns:</strong> Not a perfect fit? Send it back within 30 days using the prepaid label.</li>
      <li><strong>Damaged Gear:</strong> Just email support with photos and we’ll issue a replacement immediately.</li>
    </ul>
    <p class="modal-footnote">
      Need to change your order? Contact us within two hours before it ships and we’ll edit the shipment for you.
    </p>
  </div>
  <div class="modal-footer border-0 pt-0">
    <button type="button" class="btn btn-secondary" (click)="modal.close('close')">Close</button>
  </div>
</ng-template>

<ng-template #fieldCareModal let-modal>
  <div class="modal-header border-0 pb-2">
    <h5 class="modal-title">Field Care Tips</h5>
    <button type="button" class="btn-close btn-close-white" aria-label="Close" (click)="modal.dismiss('closed')"></button>
  </div>
  <div class="modal-body">
    <p class="mb-3">
      Keep your gear mission-ready with a few minutes of TLC after every trip.
      These rituals preserve the finish, zippers, and insulation so the kit performs year after year.
    </p>
    <ul class="sizing-checklist">
      <li><strong>Clean gently:</strong> Use cold water and a soft brush for mud, then air-dry out of direct sun.</li>
      <li><strong>Lubricate hardware:</strong> Apply a dry wax to zippers and snaps to prevent freeze and corrosion.</li>
      <li><strong>Store smart:</strong> Hang jackets or lay packs flat in a cool, dry spot—never cram them in plastic.</li>
    </ul>
    <p class="modal-footnote">
      Treat the fields like a ritual and our warranty stays active. Need personalized care advice? Ask support anytime.
    </p>
  </div>
  <div class="modal-footer border-0 pt-0">
    <button type="button" class="btn btn-secondary" (click)="modal.close('close')">Close</button>
  </div>
</ng-template>

<ng-template #faqModal let-modal>
  <div class="modal-header border-0 pb-2">
    <h5 class="modal-title">FAQ</h5>
    <button type="button" class="btn-close btn-close-white" aria-label="Close" (click)="modal.dismiss('closed')"></button>
  </div>
  <div class="modal-body">
    <p class="mb-3">
      Here are answers to the questions we hear most from hunters gearing up for the backcountry.
    </p>
    <ul class="sizing-checklist">
      <li><strong>How do I choose the right size?</strong> Use the sizing guide above and compare to a base layer set you already own.</li>
      <li><strong>When will my order arrive?</strong> Orders ship within 24 hours and usually arrive in 3-5 business days; expedited options are available at checkout.</li>
      <li><strong>Can I return or exchange?</strong> Yes—items are returnable within 30 days with the prepaid label we provide.</li>
      <li><strong>Need help with an order?</strong> Reach us at support@backcountryoutfitters.com or use live chat.</li>
    </ul>
    <p class="modal-footnote">
      We keep this list updated—if your question isn’t listed, send it to support and we’ll add it for next time.
    </p>
  </div>
  <div class="modal-footer border-0 pt-0">
    <button type="button" class="btn btn-secondary" (click)="modal.close('close')">Close</button>
  </div>
</ng-template>

<app-chat></app-chat>
